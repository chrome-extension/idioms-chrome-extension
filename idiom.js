const all_idioms = [{
	"meaning": "act before the proper or appropriate time.",
	"examples": ["We do not want to jump the gun by making a statement about what caused the explosion before the investigation is completed."],
	"title": "jump the gun"
}, {
	"meaning": "an automatic or reflex reaction to something without thinking.",
	"examples": ["It was a typical knee jerk reaction. He said no immediately without considering our proposal."],
	"title": "knee jerk reaction"
}, {
	"meaning": "extremely eager or enthusiastic.",
	"examples": ["Little kids are always as keen as mustard to learn new things around them."],
	"title": "keen as mustard"
}, {
	"meaning": "decide not to marry someone at the very last moment.",
	"examples": ["Rachel left Barry at the altar on the day of the wedding."],
	"title": "leave at the altar"
}, {
	"meaning": "used to describe a person looking sick or feeling ill or nauseous; may also refer to drool seen before vomiting.",
	"examples": ["You have had so much to eat at the party that you look green about the gills now."],
	"title": "green around the gills"
}, {
	"meaning": "Give credit to what is good in a disagreeable or disliked person.",
	"examples": ["I don't like what the new management has done, but give the devil his due, sales has improved"],
	"title": "give the devil his due"
}, {
	"meaning": "to be unaware of what is going on around.",
	"examples": ["She works in the office from 9 to 5 with her head in the clouds"],
	"title": "head in the clouds"
}, {
	"meaning": "directly at or against one in an aggressive, annoying, provocative manner that is difficult to ignore.",
	"examples": ["\"In your faces, kids\" shouted the footballer to his opponents after having scored his third goal of the match.", "Unable to tolerate his in your face attitude anymore, his boss fired him from the job."],
	"title": "in your face"
}, {
	"meaning": "forget past offences or causes of conflict and be reconciled.",
	"examples": ["The two international rivals shook hands and agreed to let bygones be bygones."],
	"title": "let bygones be bygones"
}, {
	"meaning": "mischievous or deceitful behaviour.",
	"examples": ["Do not get involved in monkey business over the internet. Cyber Laws are stricter than before."],
	"title": "monkey business"
}, {
	"meaning": "a number which is only approximate, but quite close to the correct number.",
	"examples": ["Please get me the ballpark figure for the cost of the renovation."],
	"title": "ballpark figure"
}, {
	"meaning": "full of big talk but lacking action, power, or substance; pretentious.",
	"examples": ["He has these grand plans of being an entrepreneur and owning a big business, but he never takes any action. Guess he is all bark and no bite."],
	"title": "all bark and no bite"
}, {
	"meaning": "used to convey that you cannot understand something that is written or said.",
	"examples": ["I tried reading that science journal, but it was all Greek to me."],
	"title": "it's all Greek to me"
}, {
	"meaning": "a completely different situation, often one which is difficult or which you know very little about.",
	"examples": ["We'd done a lot of climbing in Scotland, but the Himalayas were a whole new ball game."],
	"title": "a whole new ball game"
}, {
	"meaning": "it's better to be content with what you have than to risk losing everything by seeking to get more.",
	"examples": ["If I were you I'd accept the offer rather than waiting for a better one. After all, a bird in the hand is worth two in the bush."],
	"title": "a bird in the hand (is worth two in the bush)"
}, {
	"meaning": "extreme circumstances or situations that can only be resolved by resorting to equally extreme actions.",
	"examples": ["Government actions during the recession are unpopular, but desperate times call for desperate measures."],
	"title": "desperate times call for desperate measures"
}, {
	"meaning": "used to convey something that has happened was so strange that one never thought it would happen.",
	"examples": ["Never in my wildest dreams did I imagine that she'd leave me for someone else."],
	"title": "never in the wildest dreams"
}, {
	"meaning": "continuing to do something when you have almost no energy left.",
	"examples": ["Have you had any rest? You seem to be running on fumes."],
	"title": "running on fumes"
}, {
	"meaning": "confusing, meaningless, nonsensical language, especially related to a speech or religious ritual.",
	"examples": ["The politician made a right fool of himself with all that mumbo jumbo on the stage.", "It is often people who do not understand the full meaning of religion that end up in such mumbo jumbo."],
	"title": "mumbo jumbo"
}, {
	"meaning": "to work very hard, very energetically.",
	"examples": ["She has an important deadline coming up, so she's been working like a beaver."],
	"title": "work like a beaver"
}, {
	"meaning": "if you get information about something from the horse's mouth, you get it from someone who is involved in it and knows a lot about it.",
	"examples": ["I know it's true! I heard it straight from the horse's mouth!"],
	"title": "from the horse's mouth"
}, {
	"meaning": "something of trouble, burden or oppressive to someone.",
	"examples": ["His kids are a yoke around his neck.", "My manager is sometimes a yoke around my neck."],
	"title": "yoke around neck"
}, {
	"meaning": "the time at which a planned operation, typically a military one, is set to begin.",
	"examples": ["as zero hour approached, thirty ships swung into position"],
	"title": "zero hour"
}, {
	"meaning": "talk about the important point without causing any delays by discussing the preliminaries.",
	"examples": ["After a few introductory comments, we cut to the chase and began negotiating."],
	"title": "cut to the chase"
}, {
	"meaning": "to discuss private or embarrassing matters in public.",
	"examples": ["Listen, our relationship may have real problems, but it's unfortunate that you have chosen to wash our dirty linen in public."],
	"title": "wash dirty linen in public"
}, {
	"meaning": "a rehearsal of a performance or procedure before the real one.",
	"examples": ["Today is only a dry run so we will not be using the actual costumes."],
	"title": "dry run"
}, {
	"meaning": "to be mean, unfair, insulting or not following the rules.",
	"examples": ["I do not believe in fighting below the belt. The dignity of a fight is lost when people do that."],
	"title": "below the belt"
}, {
	"meaning": "used to emphasize that a person is a physical, living being with human emotions or frailties, often in contrast to something abstract, spiritual, or mechanical.",
	"examples": ["I can't do everything tirelessly like a computer, I'm only flesh and blood"],
	"title": "flesh and blood"
}, {
	"meaning": "there's something good even in bad, unpleasant situations.",
	"examples": ["I'm sorry your business is going badly, but don't despair. Every cloud has a silver lining."],
	"title": "every cloud has a silver lining"
}, {
	"meaning": "not intended to be known publicly or recorded officially",
	"examples": ["This is off the record, but I disagree with the mayor on this matter."],
	"title": "off the record"
}, {
	"meaning": "having only two very unpleasant choices.",
	"examples": ["For most people a visit to the dentist is the result of a choice between the devil and the deep blue sea - if you go you suffer, and if you don't go you suffer."],
	"title": "between the devil and the deep blue sea"
}, {
	"meaning": "very quickly or suddenly.",
	"examples": ["She cam back from college, threw her bag on the couch and left before I could say Jack Robinson."],
	"title": "before one can say Jack Robinson"
}, {
	"meaning": "no matter what happens",
	"examples": ["I'll be there tomorrow, come hell or high water."],
	"title": "come hell or high water"
}, {
	"meaning": "to make the wrong choice; to ask the wrong person; to follow the wrong course.",
	"examples": ["If you think I'm the guilty person, you're barking up the wrong tree."],
	"title": "bark up the wrong tree"
}, {
	"meaning": "almost all that you can imagine of something.",
	"examples": ["Joey orders everything but the kitchen sink when he goes out to dinner, especially if Chandler is paying for it."],
	"title": "everything but the kitchen sink"
}, {
	"meaning": "to pay a great deal of attention to the details of something, especially when you are trying to complete a task.",
	"examples": ["When you are up against Chuck, it is absolutely vital that we dot our i's and cross our t's."],
	"title": "dot the i's and cross the t's"
}, {
	"meaning": "to be in an extremely bad state and becoming worse.",
	"examples": ["After a student committed suicide, the school is going to hell in handbasket."],
	"title": "go to hell in a handbasket"
}, {
	"meaning": "to be ignored by the persons they were intended for.",
	"examples": ["He had already made up his mind, her advice fell on deaf ears."],
	"title": "fall on deaf ears"
}, {
	"meaning": "to be in a favorable position; in total control",
	"examples": ["We held all the aces in the election."],
	"title": "hold all the aces"
}, {
	"meaning": "to do exactly the right thing; to describe exactly what is causing a situation or problem",
	"examples": ["His speech at the farewell ceremony hit the nail on the head about the company's situation."],
	"title": "hit the nail on the head"
}, {
	"meaning": "if you could achieve your aims simply by wishing for them, life would be very easy.",
	"examples": ["I wish to go on a trip to Mars, but alas! if wishes were horses, beggars would ride."],
	"title": "if wishes were horses, beggars would ride"
}, {
	"meaning": "accept a gift gladly without inspecting it for defects.",
	"examples": ["It's so refreshing to work with someone who will throw a saddle on a gift horse rather than look it in the mouth."],
	"title": "throw saddle on a gift horse"
}, {
	"meaning": "to know when you are really done or finished with something",
	"examples": ["Investigator said \"I would let you go when I've scraped all the shit off the shoe\", when the suspect tried to leave the interrogation."],
	"title": "scrape all the shit of the shoe"
}, {
	"meaning": "to be ungrateful to someone who gives you something, a gift especially",
	"examples": ["It's so refreshing to work with someone who will throw a saddle on a gift horse rather than look it in the mouth."],
	"title": "look a gift-horse in the mouth"
}, {
	"meaning": "more than anything else; in a great quantity",
	"examples": ["He leaned over and kissed him goodnight. Then he lay down close by and whispered with a smile, \"I love you to the moon and back.\""],
	"title": "to the moon and back"
}, {
	"meaning": "to have just enough money to live on and nothing extra.",
	"examples": ["My father earned very little and there were four kids, so we lived from hand to mouth."],
	"title": "live (from) hand to mouth"
}, {
	"meaning": "to be very calm and content, even in unnerving situations.",
	"examples": ["The girl was as calm as a toad in the sun during the speech contest."],
	"title": "as calm as a toad in the sun"
}, {
	"meaning": "very tidy, neat, and well-organized; in good order.",
	"examples": ["Her desk looks as nice as ninepence.", "The college library is as nice as ninepence."],
	"title": "as nice as ninepence"
}, {
	"meaning": "all well and active as far as health is concerned.",
	"examples": ["The old man was all alive and kicking even in the nineties"],
	"title": "alive and kicking"
}, {
	"meaning": "a time very early in the morning; daybreak.",
	"examples": ["It's a long drive, we'll leave at the crack of dawn."],
	"title": "at the crack of dawn"
}, {
	"meaning": "to select from among the worst; to choose from what is left over.",
	"examples": ["The worker you sent over was the worst I've ever seen. Send me another\u2014and don't scrape the bottom of the barrel."],
	"title": "scrape the bottom of the barrel"
}, {
	"meaning": "used to refuse an offer politely, with the implication that one may take it up at a later date.",
	"examples": ["They wanted me to come along for the ride but I took a rain check"],
	"title": "take a rain check"
}, {
	"meaning": "a precise resemblance, especially in closely related persons.",
	"examples": ["People have told me that I look like him, act like him, that my kids are the spitting image of him."],
	"title": "spitting image"
}, {
	"meaning": "to do or say something that causes trouble and makes a lot of people angry or worried",
	"examples": ["Tell them all they've got to work on Saturday. That should set the cat among the pigeons."],
	"title": "put/set the cat among the pigeons"
}, {
	"meaning": "standard rules of polite or acceptable behavior; code of conduct",
	"examples": ["HR handed over the sheet that listed the Queensberry rules of the company on the first day at work."],
	"title": "the Queensberry rules"
}, {
	"meaning": "a day that is pleasantly noteworthy or memorable.",
	"examples": ["The day I first set foot in America was a red-letter day for me."],
	"title": "red letter day"
}, {
	"meaning": "the newest person in a group",
	"examples": ["I'm just the new kid on the block. I've only been working here for a month."],
	"title": "new kid on the block"
}, {
	"meaning": "to do something surprising",
	"examples": ["GRR Martin pulls a rabbit out of the hat at the end of the story."],
	"title": "pull a rabbit out of your hat"
}, {
	"meaning": "have no hesitation in stating or dealing with (something), however unpleasant or awkward it is.",
	"examples": ["He made no bones about how bad he thought the food was."],
	"title": "make no bones about"
}, {
	"meaning": "an extremely short period of time",
	"examples": ["I'll have that ready for you in a New York Minute."],
	"title": "New York minute"
}, {
	"meaning": "do not instigate trouble.; Leave something alone if it might cause trouble.",
	"examples": ["I thought I would ask Jill if she wanted me to pay her back right away, but then I decided to let sleeping dogs lie."],
	"title": "let sleeping dogs lie"
}, {
	"meaning": "to fall asleep, esp from physical exhaustion or the effects of alcohol or drugs",
	"examples": ["The driver zonked out behind the wheel and ran off the road."],
	"title": "zonk out"
}, {
	"meaning": "an abrupt and complete reversal of attitude, opinion, or position.",
	"examples": ["After losing the election, he made a very public and dramatic political volte-face from Left to Right."],
	"title": "volte-face"
}, {
	"meaning": "when a very serious situation arises.",
	"examples": ["I knew you would come and help when the chips were down."],
	"title": "when the chips are down"
}, {
	"meaning": "to befriend, look after, or take care of someone who proves to be traitorous, untrustworthy, deceitful, or ungrateful.",
	"examples": ["I got my friend a good position in my company and all he did is convinced my manger to fire me, that's when I realized I nursed a viper in my bosom."],
	"title": "nurse a viper in one's bosom"
}, {
	"meaning": "in a mysterious or hidden place or state, especially the unknown state of life after death.",
	"examples": ["Mike realized that his father had passed irrevocably beyond the veil."],
	"title": "beyond the veil"
}, {
	"meaning": "use one's common sense.",
	"examples": ["You haven't even switched the thing on. Come on, Jamie, use your loaf!"],
	"title": "use your loaf"
}, {
	"meaning": "increase what is at stake or under discussion, especially in a conflict or dispute.",
	"examples": ["Pete upped the ante on that the poker game to $100 per hand."],
	"title": "up the ante"
}, {
	"meaning": "to be very appropriate for someone",
	"examples": ["This kind of job suits me to a T."],
	"title": "suit someone to a T"
}, {
	"meaning": "deal decisively with a difficult or dangerous situation.",
	"examples": ["It's time to take the bull by the horns and get this job done."],
	"title": "take the bull by the horns"
}, {
	"meaning": "a charitable or helpful person",
	"examples": ["An anonymous good Samaritan rescued a child from the river yesterday, but left the area before he could be thanked."],
	"title": "good Samaritan"
}, {
	"meaning": "a tiny portion of something",
	"examples": ["I don\u2019t want a jot or tittle of the cake, I want the whole thing."],
	"title": "jot or tittle"
}, {
	"meaning": "try every possible course of action in order to achieve something",
	"examples": ["He left no stone unturned in his search for his natural mother."],
	"title": "leave no stone unturned"
}, {
	"meaning": "an unofficial court set up by a group of people",
	"examples": ["Is this a staff meeting or a kangaroo court?"],
	"title": "Kangaroo court"
}, {
	"meaning": "read or work late into the night",
	"examples": ["I've got to get this report finished by tomorrow so I guess I'll be burning the midnight oil tonight."],
	"title": "burn the midnight oil"
}, {
	"meaning": "very little space, cramped quarters",
	"examples": ["There's not enough room to swing a cat in this tent."],
	"title": "no room to swing a cat"
}, {
	"meaning": "to do things in the wrong order",
	"examples": ["If you're starting to write code without thinking out the logic, you're putting the cart before the horse."],
	"title": "put the cart before the horse"
}, {
	"meaning": "a small, poor country with a weak or dishonest government",
	"examples": ["People fear that the country will become a banana republic if the economy doesn't pick up."],
	"title": "banana republic"
}, {
	"meaning": "loss of something that required only a small amount of effort to acquire in the first place",
	"examples": ["I lost 10k at the casino last night, but that's life - easy come, easy go."],
	"title": "easy come, easy go"
}, {
	"meaning": "a twofold blow or setback",
	"examples": ["Increasing taxes and falling prices of grains is a double whammy for poor farmers."],
	"title": "double whammy"
}];

function makeUL(array) {

  // If there's just one element in the list, just return a simple span
  // else create a ul li list
  if(array.length === 1) {
    var item = document.createElement('span');
    item.appendChild(document.createTextNode(array[0]));
    return item;
  }

  // Create the list element:
  var list = document.createElement('ul');

  for(var i = 0; i < array.length; i++) {
    // Create the list item:
    var item = document.createElement('li');
    // Set its contents:
    item.appendChild(document.createTextNode(array[i]));
    // Add it to the list:
    list.appendChild(item);
  }

  // Finally, return the constructed list:
  return list;
}

function getPrevDate() {
  var d = new Date();
  d.setDate(d.getDate() - 1);
  query = d.getDate() + '-' + (d.getMonth()+1) + '-' + d.getFullYear();
  return query;
}

function getCurrDate() {
  // Create the date for which we need the idiom
  var d = new Date();
  query = d.getDate() + '-' + (d.getMonth()+1) + '-' + d.getFullYear();
  return query;
}


function renderContent(response) {
  console.log(response['title']);
  console.log(response['meaning']);
  console.log(makeUL(response['examples']));
  console.log($('#idiom-title'));
  $('#idiom-title').text(response['title']);
  $('#idiom-meaning').text(response['meaning']);
  $('#idiom-example').append(makeUL(response['examples']));
  $('#idiom-body-placeholder').hide();
  $('#idiom-body').fadeIn();
  console.log("render finished");
}


function setLocal(response) {
  var key = 'idiom-of-the-day-' + getCurrDate();
  var idiom = {};
  idiom[key] = response;
  chrome.storage.local.set(idiom);

  // Delete yesterday's data
  var del_key = 'idiom-of-the-day-' + getPrevDate();
  chrome.storage.local.remove(del_key);
}

function getFromLocal() {
  var key = 'idiom-of-the-day-' + getCurrDate();
  chrome.storage.local.get(key, function(response) {
    if(response[key] && response[key]['title']) {
      response = response[key];
      renderContent(response);
    } else {
      const random_idx = Math.floor(Math.random() * all_idioms.length);
      console.log(all_idioms[random_idx]);
      renderContent(all_idioms[random_idx]);
    }
  });
}



// Most visited websites


function createMVLink(data) {
  // data - dict
  // data = { title: 'my title', url: 'http://www.google.com'}

  // We are creating a structure like this
  // <a class="mv-link" href="{url}">
  //   <div class="mv-favicon"></div>
  //   <div class="mv-title"></div>
  // </a>

  // This is parent
  var mv_link = document.createElement("a");
  mv_link.setAttribute('class', 'mv-link');
  mv_link.setAttribute('href', data.url);

  // This is child of anchor tag
  var mv_favicon = document.createElement("div");
  mv_favicon.setAttribute('class', 'mv-favicon');
  mv_favicon.style.backgroundImage = 'url(chrome://favicon/' + data.url + ')';

  mv_link.appendChild(mv_favicon);

  // This is child of anchor tag
  var mv_title = document.createElement("div");
  mv_title.setAttribute('class', 'mv-title');
  mv_title.setAttribute('title', data.title);
  mv_title.textContent = data.title;

  mv_link.appendChild(mv_title);

  document.getElementById("most-visited-sites").appendChild(mv_link);
}

function createTopSitesDiv(data) {
  var mx = Math.min(data.length, 4);

  for(var i=0; i<mx; i++) {
    createMVLink(data[i]);
  }
}

if(window.location.href.indexOf('new_tab_idiom.html') !== -1) {
  getFromLocal();
  chrome.topSites.get(createTopSitesDiv);
}
